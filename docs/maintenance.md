# Project Maintenance Guide

This guide covers maintenance procedures for keeping the pysearch project clean, organized, and efficient.

## Table of Contents

- [Project Cleanup](#project-cleanup)
- [Cache Management](#cache-management)
- [Virtual Environment Management](#virtual-environment-management)
- [Build Artifacts](#build-artifacts)
- [Regular Maintenance Tasks](#regular-maintenance-tasks)
- [Troubleshooting](#troubleshooting)

---

## Project Cleanup

### Recent Cleanup (Completed)

The project has been recently cleaned and organized with the following improvements:

#### Removed Files and Directories
- **Cache directories**: `.mypy_cache`, `.mypy_cache_temp`, `.pytest_cache`, `.benchmarks`, `.coverage`, `.pysearch-cache`
- **Build artifacts**: `coverage.xml`, `src/pysearch.egg-info`, `mcp/__pycache__`
- **Duplicate virtual environment**: Removed `venv/`, kept `.venv/` as the active environment
- **Compiled Python files**: All `*.pyc` files in project directories

#### Benefits Achieved
- **Reduced disk usage**: Removed several hundred MB of unnecessary files
- **Cleaner repository**: Better compliance with `.gitignore` patterns
- **Faster operations**: Fewer files to scan during development
- **Better organization**: Clear separation between source and generated files

### Maintaining Clean Project Structure

```text
├── src/pysearch/          # Core library (keep)
├── mcp/                   # MCP servers (keep)
├── tools/                 # Development tools (keep)
├── examples/              # Usage examples (keep)
├── tests/                 # Test suite (keep)
├── docs/                  # Documentation (keep)
├── scripts/               # Build scripts (keep)
├── configs/               # Configuration (keep)
├── .venv/                 # Virtual environment (keep)
├── .git/                  # Version control (keep)
├── .github/               # GitHub workflows (keep)
└── .devcontainer/         # Dev container config (keep)
```

---

## Cache Management

### Automatic Cache Regeneration

All cache directories are automatically regenerated when needed:

| Cache Directory | Purpose | Regenerated By |
|----------------|---------|----------------|
| `.mypy_cache/` | Type checking cache | `mypy` or `make type` |
| `.pytest_cache/` | Test execution cache | `pytest` or `make test` |
| `.pysearch-cache/` | Application cache | PySearch indexing |
| `.benchmarks/` | Benchmark results | `pytest` benchmarks |
| `.coverage/` | Coverage data | `pytest --cov` |
| `__pycache__/` | Python bytecode | Python interpreter |

### Manual Cache Cleanup

```bash
# Clean all cache files and build artifacts
make clean

# Or manually remove specific caches
rm -rf .mypy_cache .pytest_cache .pysearch-cache
rm -rf .coverage coverage.xml
find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
```

### Cache Best Practices

1. **Don't commit cache files**: Ensure `.gitignore` excludes all cache directories
2. **Regular cleanup**: Run `make clean` periodically during development
3. **CI/CD**: Always start with clean cache in continuous integration
4. **Disk space**: Monitor cache sizes in large projects

---

## Virtual Environment Management

### Current Setup

- **Active environment**: `.venv/` (Python virtual environment)
- **Removed**: `venv/` (duplicate environment)

### Virtual Environment Best Practices

```bash
# Activate the project virtual environment
source .venv/bin/activate  # Linux/macOS
# .venv\Scripts\activate   # Windows

# Install development dependencies
pip install -e ".[dev]"

# Deactivate when done
deactivate
```

### Recreating Virtual Environment

If you need to recreate the virtual environment:

```bash
# Remove existing environment
rm -rf .venv

# Create new environment
python -m venv .venv

# Activate and install dependencies
source .venv/bin/activate
pip install -e ".[dev]"
```

---

## Build Artifacts

### Automatically Cleaned Files

The `make clean` command removes:

```bash
# Build outputs
build/ dist/ sdist/ wheels/

# Cache directories
.pytest_cache/ .mypy_cache/ .mypy_cache_temp/ .ruff_cache/
.coverage/ htmlcov/ .benchmarks/ .pysearch-cache/

# Documentation builds
site/ .mkdocs_cache/ docs_build/ .docstring_cache/ .api_docs_cache/

# Package metadata
src/*.egg-info/

# Python bytecode
**/__pycache__/
```

### Build Process

```bash
# Clean build
make clean

# Run validation
make validate

# Build package
make release
```

---

## Regular Maintenance Tasks

### Daily Development

```bash
# Start development session
source .venv/bin/activate
make validate  # Ensure everything works

# End development session
deactivate
```

### Weekly Maintenance

```bash
# Clean up accumulated cache files
make clean

# Update dependencies (if needed)
pip install -U pip
pip install -e ".[dev]" --upgrade

# Run full validation
make validate
```

### Monthly Maintenance

```bash
# Check for large cache directories
du -sh .mypy_cache .pytest_cache .pysearch-cache 2>/dev/null || true

# Review .gitignore for new patterns
git status --ignored

# Update documentation if project structure changes
make docs
```

### Before Releases

```bash
# Complete cleanup and validation
make clean
make validate

# Build and test package
make release

# Verify documentation is up to date
make docs-check
```

---

## Troubleshooting

### Common Issues

#### Cache Corruption
**Problem**: Tests or type checking behave unexpectedly

**Solution**:
```bash
make clean  # Remove all cache files
make test   # Regenerate test cache
make type   # Regenerate type cache
```

#### Disk Space Issues
**Problem**: Cache directories consuming too much space

**Solution**:
```bash
# Check cache sizes
du -sh .mypy_cache .pytest_cache .pysearch-cache

# Clean all caches
make clean

# Consider excluding large files from indexing
```

#### Virtual Environment Issues
**Problem**: Import errors or dependency conflicts

**Solution**:
```bash
# Recreate virtual environment
rm -rf .venv
python -m venv .venv
source .venv/bin/activate
pip install -e ".[dev]"
```

#### Build Failures
**Problem**: Package build fails with old artifacts

**Solution**:
```bash
# Complete cleanup
make clean
rm -rf build/ dist/

# Fresh build
make release
```

### Getting Help

1. **Check this maintenance guide** for common solutions
2. **Run validation**: `make validate` to identify issues
3. **Clean and retry**: `make clean` then retry the operation
4. **Check documentation**: Review relevant docs in `docs/`
5. **Create an issue**: If problems persist, create a GitHub issue

---

## Automation

### Pre-commit Hooks

The project uses pre-commit hooks to maintain code quality:

```bash
# Install hooks
pre-commit install

# Run manually
pre-commit run --all-files
```

### CI/CD Integration

Continuous integration automatically:
- Runs `make clean` before testing
- Validates code quality with `make validate`
- Builds documentation with `make docs`
- Tests across multiple Python versions

### IDE Integration

Configure your IDE to:
- Use `.venv/bin/python` as the interpreter
- Run `make format` on save
- Exclude cache directories from indexing
- Use project-specific settings

---

This maintenance guide ensures the pysearch project remains clean, efficient, and easy to work with. Regular maintenance prevents accumulation of unnecessary files and keeps the development environment optimal.
